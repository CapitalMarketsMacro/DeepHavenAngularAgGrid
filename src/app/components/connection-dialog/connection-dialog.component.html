<div class="dialog-overlay">
  <div class="dialog">
    <h2>Connect to DeepHaven</h2>

    @if (isLoadingConfig()) {
      <div class="loading-config">Loading configuration...</div>
    } @else if (configError()) {
      <div class="error-message">{{ configError() }}</div>
    } @else {
      @if (configMode()) {
        <div class="config-mode">
          Mode: <strong>{{ configMode() }}</strong>
        </div>
      }

      <form (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label>Select Table</label>

          @if (isLoadingTables()) {
            <div class="loading-tables">Loading available tables...</div>
          } @else if (availableTables().length > 0 && !useCustomTable()) {
            <select
              [ngModel]="selectedTable()"
              (ngModelChange)="selectedTable.set($event)"
              name="selectedTable"
              [disabled]="isSubmitting()"
            >
              <option value="">-- Select a table --</option>
              @for (table of availableTables(); track table.name) {
                <option [value]="table.name">{{ table.name }} ({{ table.type }})</option>
              }
            </select>
            <button type="button" class="link-button" (click)="toggleCustomTable()">
              Or enter table name manually
            </button>
          } @else {
            <input
              type="text"
              id="tableName"
              [ngModel]="customTableName()"
              (ngModelChange)="customTableName.set($event)"
              name="customTableName"
              placeholder="e.g., myTable or scope/tableName"
              [disabled]="isSubmitting()"
              autofocus
            />
            @if (availableTables().length > 0) {
              <button type="button" class="link-button" (click)="toggleCustomTable()">
                Select from available tables
              </button>
            }
          }
        </div>

        @if (errorMessage()) {
          <div class="error-message">
            {{ errorMessage() }}
          </div>
        }

        <button type="submit" [disabled]="isSubmitting() || isLoadingTables()">
          @if (isSubmitting()) {
            Connecting...
          } @else {
            Connect
          }
        </button>
      </form>

      <div class="config-hint">
        <small>
          Configure via URL: <code>?enterprise=true|false&viewport=true|false</code>
        </small>
      </div>
    }
  </div>
</div>
